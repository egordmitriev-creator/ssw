<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <!-- Инициализация структуры БД -->
    <changeSet id="1" author="your_name">
        <comment>Создание базовых таблиц</comment>

        <!-- Таблица customer -->
        <createTable tableName="customer">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="city" type="VARCHAR(255)"/>
            <column name="street" type="VARCHAR(255)"/>
            <column name="zipcode" type="VARCHAR(50)"/>
        </createTable>

        <!-- Таблица item -->
        <createTable tableName="item">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="shipping_weight_value" type="DECIMAL(19,2)"/>
            <column name="shipping_weight_measurement_name" type="VARCHAR(255)"/>
            <column name="shipping_weight_measurement_symbol" type="VARCHAR(50)"/>
            <column name="description" type="TEXT"/>
        </createTable>

        <!-- Таблица order (используем кавычки, так как order - зарезервированное слово) -->
        <createTable tableName="orders">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="date" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="customer_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_order_customer"
                             referencedTableName="customer" referencedColumnNames="id"/>
            </column>
        </createTable>

        <!-- Таблица order_detail -->
        <createTable tableName="order_detail">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="quantity_value" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="quantity_measurement_name" type="VARCHAR(255)"/>
            <column name="quantity_measurement_symbol" type="VARCHAR(50)"/>
            <column name="tax_status" type="VARCHAR(50)"/>
            <column name="order_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_order_detail_order"
                             referencedTableName="orders" referencedColumnNames="id"/>
            </column>
            <column name="item_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_order_detail_item"
                             referencedTableName="item" referencedColumnNames="id"/>
            </column>
        </createTable>

        <!-- Таблица payment с наследованием -->
        <createTable tableName="payment">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="amount" type="DECIMAL(19,2)">
                <constraints nullable="false"/>
            </column>
            <column name="payment_type" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="order_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_payment_order"
                             referencedTableName="orders" referencedColumnNames="id"/>
            </column>
            <!-- Поля для Cash -->
            <column name="cash_tendered" type="DECIMAL(19,2)"/>
            <!-- Поля для Check -->
            <column name="check_name" type="VARCHAR(255)"/>
            <column name="bank_id" type="VARCHAR(255)"/>
            <!-- Поля для Credit -->
            <column name="credit_number" type="VARCHAR(50)"/>
            <column name="credit_type" type="VARCHAR(50)"/>
            <column name="exp_date" type="TIMESTAMP"/>
        </createTable>
    </changeSet>

    <!-- Добавление индексов для улучшения производительности -->
    <changeSet id="2" author="your_name">
        <comment>Добавление индексов для часто используемых полей</comment>

        <createIndex tableName="orders" indexName="idx_order_customer">
            <column name="customer_id"/>
        </createIndex>

        <createIndex tableName="orders" indexName="idx_order_date">
            <column name="date"/>
        </createIndex>

        <createIndex tableName="orders" indexName="idx_order_status">
            <column name="status"/>
        </createIndex>

        <createIndex tableName="order_detail" indexName="idx_order_detail_order">
            <column name="order_id"/>
        </createIndex>
    </changeSet>

    <!-- Пример добавления новых полей в будущих версиях -->
    <changeSet id="3" author="your_name">
        <comment>Добавление поля email в таблицу customer</comment>

        <addColumn tableName="customer">
            <column name="email" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>
</databaseChangeLog>